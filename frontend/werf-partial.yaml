---
image: frontendBuild
final: false
from: docker.io/library/node:18-alpine
fromCacheVersion: {{ .cacheVersion }}
git:
  - to: /app
    includePaths:
      - frontend/*
    excludePaths:
      - frontend/werf-partial.yaml
shell:
  beforeSetup:
    - cd /app
    - npm install --production
    - npm run build
---
image: frontend
from: docker.io/library/nginx:1-alpine
fromCacheVersion: {{ .cacheVersion }}
import:
  - image: frontendBuild
    after: install
    add: /app/dist
    to: /usr/share/nginx/html
git:
  - add: /frontend/nginx.conf
    to: /etc/nginx/conf.d/default.conf
